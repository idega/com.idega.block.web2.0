!function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance},e=function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e.push(d(a[f]));b.apply(null,b)},f={};f.bolt={module:{api:{define:c,require:e,demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("6",tinymce.util.Tools.resolve),g("1",["6"],function(a){return a("tinymce.html.DomParser")}),g("2",["6"],function(a){return a("tinymce.html.Node")}),g("3",["6"],function(a){return a("tinymce.html.Serializer")}),g("4",["6"],function(a){return a("tinymce.PluginManager")}),g("5",["6"],function(a){return a("tinymce.util.Tools")}),g("0",["1","2","3","4","5"],function(a,b,c,d,e){return d.add("fullpage",function(d){function f(){var a=g();d.windowManager.open({title:"Document properties",data:a,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(b){h(e.extend(a,b.data))}})}function g(){function a(a,b){var c=a.attr(b);return c||""}var b,c,f=i(),g={};return g.fontface=d.getParam("fullpage_default_fontface",""),g.fontsize=d.getParam("fullpage_default_fontsize",""),b=f.firstChild,7==b.type&&(g.xml_pi=!0,c=/encoding="([^"]+)"/.exec(b.value),c&&(g.docencoding=c[1])),b=f.getAll("#doctype")[0],b&&(g.doctype="<!DOCTYPE"+b.value+">"),b=f.getAll("title")[0],b&&b.firstChild&&(g.title=b.firstChild.value),o(f.getAll("meta"),function(a){var b,c=a.attr("name"),d=a.attr("http-equiv");c?g[c.toLowerCase()]=a.attr("content"):"Content-Type"==d&&(b=/charset\s*=\s*(.*)\s*/gi.exec(a.attr("content")),b&&(g.docencoding=b[1]))}),b=f.getAll("html")[0],b&&(g.langcode=a(b,"lang")||a(b,"xml:lang")),g.stylesheets=[],e.each(f.getAll("link"),function(a){"stylesheet"==a.attr("rel")&&g.stylesheets.push(a.attr("href"))}),b=f.getAll("body")[0],b&&(g.langdir=a(b,"dir"),g.style=a(b,"style"),g.visited_color=a(b,"vlink"),g.link_color=a(b,"link"),g.active_color=a(b,"alink")),g}function h(a){function f(a,b,c){a.attr(b,c?c:void 0)}function g(a){j.firstChild?j.insert(a,j.firstChild):j.append(a)}var h,j,k,l,n,p=d.dom;h=i(),j=h.getAll("head")[0],j||(l=h.getAll("html")[0],j=new b("head",1),l.firstChild?l.insert(j,l.firstChild,!0):l.append(j)),l=h.firstChild,a.xml_pi?(n='version="1.0"',a.docencoding&&(n+=' encoding="'+a.docencoding+'"'),7!=l.type&&(l=new b("xml",7),h.insert(l,h.firstChild,!0)),l.value=n):l&&7==l.type&&l.remove(),l=h.getAll("#doctype")[0],a.doctype?(l||(l=new b("#doctype",10),a.xml_pi?h.insert(l,h.firstChild):g(l)),l.value=a.doctype.substring(9,a.doctype.length-1)):l&&l.remove(),l=null,o(h.getAll("meta"),function(a){"Content-Type"==a.attr("http-equiv")&&(l=a)}),a.docencoding?(l||(l=new b("meta",1),l.attr("http-equiv","Content-Type"),l.shortEnded=!0,g(l)),l.attr("content","text/html; charset="+a.docencoding)):l&&l.remove(),l=h.getAll("title")[0],a.title?(l?l.empty():(l=new b("title",1),g(l)),l.append(new b("#text",3)).value=a.title):l&&l.remove(),o("keywords,description,author,copyright,robots".split(","),function(c){var d,e,f=h.getAll("meta"),i=a[c];for(d=0;d<f.length;d++)if(e=f[d],e.attr("name")==c)return void(i?e.attr("content",i):e.remove());i&&(l=new b("meta",1),l.attr("name",c),l.attr("content",i),l.shortEnded=!0,g(l))});var q={};e.each(h.getAll("link"),function(a){"stylesheet"==a.attr("rel")&&(q[a.attr("href")]=a)}),e.each(a.stylesheets,function(a){q[a]||(l=new b("link",1),l.attr({rel:"stylesheet",text:"text/css",href:a}),l.shortEnded=!0,g(l)),delete q[a]}),e.each(q,function(a){a.remove()}),l=h.getAll("body")[0],l&&(f(l,"dir",a.langdir),f(l,"style",a.style),f(l,"vlink",a.visited_color),f(l,"link",a.link_color),f(l,"alink",a.active_color),p.setAttribs(d.getBody(),{style:a.style,dir:a.dir,vLink:a.visited_color,link:a.link_color,aLink:a.active_color})),l=h.getAll("html")[0],l&&(f(l,"lang",a.langcode),f(l,"xml:lang",a.langcode)),j.firstChild||j.remove(),k=new c({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(h),m=k.substring(0,k.indexOf("</body>"))}function i(){return new a({validate:!1,root_name:"#document"}).parse(m)}function j(a){function b(a){return a.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase()})}var c,f,g,h,j=a.content,l="",p=d.dom;if(!a.selection&&!("raw"==a.format&&m||a.source_view&&d.getParam("fullpage_hide_in_source_view"))){0!==j.length||a.source_view||(j=e.trim(m)+"\n"+e.trim(j)+"\n"+e.trim(n)),j=j.replace(/<(\/?)BODY/gi,"<$1body"),c=j.indexOf("<body"),c!=-1?(c=j.indexOf(">",c),m=b(j.substring(0,c+1)),f=j.indexOf("</body",c),f==-1&&(f=j.length),a.content=j.substring(c+1,f),n=b(j.substring(f))):(m=k(),n="\n</body>\n</html>"),g=i(),o(g.getAll("style"),function(a){a.firstChild&&(l+=a.firstChild.value)}),h=g.getAll("body")[0],h&&p.setAttribs(d.getBody(),{style:h.attr("style")||"",dir:h.attr("dir")||"",vLink:h.attr("vlink")||"",link:h.attr("link")||"",aLink:h.attr("alink")||""}),p.remove("fullpage_styles");var q=d.getDoc().getElementsByTagName("head")[0];l&&(p.add(q,"style",{id:"fullpage_styles"},l),h=p.get("fullpage_styles"),h.styleSheet&&(h.styleSheet.cssText=l));var r={};e.each(q.getElementsByTagName("link"),function(a){"stylesheet"==a.rel&&a.getAttribute("data-mce-fullpage")&&(r[a.href]=a)}),e.each(g.getAll("link"),function(a){var b=a.attr("href");return!b||(r[b]||"stylesheet"!=a.attr("rel")||p.add(q,"link",{rel:"stylesheet",text:"text/css",href:b,"data-mce-fullpage":"1"}),void delete r[b])}),e.each(r,function(a){a.parentNode.removeChild(a)})}}function k(){var a,b="",c="";return d.getParam("fullpage_default_xml_pi")&&(b+='<?xml version="1.0" encoding="'+d.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),b+=d.getParam("fullpage_default_doctype","<!DOCTYPE html>"),b+="\n<html>\n<head>\n",(a=d.getParam("fullpage_default_title"))&&(b+="<title>"+a+"</title>\n"),(a=d.getParam("fullpage_default_encoding"))&&(b+='<meta http-equiv="Content-Type" content="text/html; charset='+a+'" />\n'),(a=d.getParam("fullpage_default_font_family"))&&(c+="font-family: "+a+";"),(a=d.getParam("fullpage_default_font_size"))&&(c+="font-size: "+a+";"),(a=d.getParam("fullpage_default_text_color"))&&(c+="color: "+a+";"),b+="</head>\n<body"+(c?' style="'+c+'"':"")+">\n"}function l(a){a.selection||a.source_view&&d.getParam("fullpage_hide_in_source_view")||(a.content=e.trim(m)+"\n"+e.trim(a.content)+"\n"+e.trim(n))}var m,n,o=e.each;d.addCommand("mceFullPageProperties",f),d.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),d.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"}),d.on("BeforeSetContent",j),d.on("GetContent",l)}),function(){}}),d("0")()}();